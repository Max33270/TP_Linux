# TP1 : Familiaration avec un système GNU/Linux - Maxim Doublait B2B

## 0. Préparation de la machine

``` 
[max@node1 ~]$ sudo nano /etc/resolv.conf

Generated by NetworkManager 
nameserver 1.1.1.1 
````

``` 
[max@node2 ~]$ sudo nano /etc/resolv.conf

Generated by NetworkManager 
nameserver 1.1.1.1 
````

```
[max@node1 ~]$ dig ynov.com
;; ANSWER SECTION:
ynov.com.		300	IN	A	104.26.10.233
ynov.com.		300	IN	A	104.26.11.233
ynov.com.		300	IN	A	172.67.74.226


;; SERVER: 192.168.1.254#53(192.168.1.254)
```

```
[max@node1 ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3 enp0s8
  sources:
  services: ssh
  ports:
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```

```
[max@node2 etc]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3 enp0s8
  sources:
  services: ssh
  ports:
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```

## 1. Utilisateurs

### 1. Création et configuration 

```
[max@node1 ~]$ sudo useradd mdoub -m -s /bin/sh
```

```
[max@node1 ~]$ cat /etc/passwd
mdoub:x:1001:1001::/home/mdoub:/bin/sh
```

```
[max@node2 ~]$ sudo useradd mdoub -m -s /bin/sh
```

```
[max@node2 ~]$ cat /etc/passwd
mdoub:x:1001:1001::/home/mdoub:/bin/sh
```

```
[max@node1 ~]$ sudo groupadd admins 
[max@node1 ~]$ sudo visudo /etc/sudoers
[max@node1 ~]$ sudo cat /etc/sudoers 
%admins ALL=(ALL)	ALL 
```
```
[max@node2 ~]$ sudo groupadd admins 
[max@node2 ~]$ sudo visudo /etc/sudoers
[max@node2 ~]$ sudo cat /etc/sudoers 
%admins ALL=(ALL)	ALL 
```

```
[max@node1 ~]$ sudo usermod -aG admins mdoub
[max@node1 ~]$ su mdoub
[mdoub@node1 max]$ sudo cat /etc/sudoers | grep admins

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for mdoub: 
%admins ALL=(ALL)	ALL
```

```
[max@node2 ~]$ sudo usermod -aG admins mdoub
[max@node2 ~]$ su admin
[mdoub@node2 max]$ sudo cat /etc/sudoers | grep admins

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for mdoub: 
%admins ALL=(ALL)	ALL
```

### 2. SSH

```
maxdoublait@Maxs-MacBook-Pro ~ % ssh-keygen -t rsa -b 4096
Generating public/private rsa key pair.
maxdoublait@Maxs-MacBook-Pro ~ % ssh-copy-id max@10.101.1.11
```

``` 
maxdoublait@Maxs-MacBook-Pro ~ % ssh max@10.101.1.11
Last login: Mon Nov 14 12:28:16 2022 from 10.101.1.1
``` 

## 2. Partitionnement 

### 1. Préparation de la VM

```
[max@node1 ~]$ lsblk
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0    8G  0 disk
├─sda1        8:1    0    1G  0 part /boot
└─sda2        8:2    0    7G  0 part
  ├─rl-root 253:0    0  6.2G  0 lvm  /
  └─rl-swap 253:1    0  820M  0 lvm  [SWAP]
sdb           8:16   0    3G  0 disk
sdc           8:32   0    3G  0 disk
sr0          11:0    1 1024M  0 rom
sr1          11:1    1 1024M  0 rom
[max@node1 ~]$ sudo pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[max@node1 ~]$ sudo pvcreate /dev/sdc
  Physical volume "/dev/sdc" successfully created.
[max@node1 ~]$ sudo vgcreate data /dev/sdb
  Volume group "data" successfully created
[max@node1 ~]$ sudo vgextend data /dev/sdc
  Volume group "data" successfully extended
[max@node1 ~]$ sudo lvcreate -L 1G data -n partition1
  Logical volume "partition1" created.
[max@node1 ~]$ sudo lvcreate -L 1G data -n partition2
  Logical volume "partition2" created.
[max@node1 ~]$ sudo lvcreate -L 1G data -n partition3
  Logical volume "partition3" created.
[max@node1 ~]$ sudo mkfs -t ext4 /dev/data/partition1
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 262144 4k blocks and 65536 inodes
Filesystem UUID: 7910f1e3-4a50-4637-8f2c-a6a51a2492be
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376

Allocating group tables: done
Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done

[max@node1 ~]$ sudo mkfs -t ext4 /dev/data/partition2
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 262144 4k blocks and 65536 inodes
Filesystem UUID: 3cdbd6f5-ed7e-40ac-b64d-e0c041ddd876
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376

Allocating group tables: done
Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done

[max@node1 ~]$ sudo mkfs -t ext4 /dev/data/partition3
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 262144 4k blocks and 65536 inodes
Filesystem UUID: 4a1c1673-6c90-446c-a20f-9e931d06e220
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376

Allocating group tables: done
Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done

[max@node1 ~]$ sudo mkdir /mnt/p1
[max@node1 ~]$ sudo mkdir /mnt/p2
[max@node1 ~]$ sudo mkdir /mnt/p3
[max@node1 ~]$ sudo mount /dev/data/partition1 /mnt/p1
[max@node1 ~]$ sudo mount /dev/data/partition2 /mnt/p2
[max@node1 ~]$ sudo mount /dev/data/partition3 /mnt/p3
[max@node1 ~]$ mount
/dev/mapper/data-partition1 on /mnt/p1 type ext4 (rw,relatime,seclabel)
/dev/mapper/data-partition2 on /mnt/p2 type ext4 (rw,relatime,seclabel)
/dev/mapper/data-partition3 on /mnt/p3 type ext4 (rw,relatime,seclabel)
```

```
[max@node1 ~]$ cat /etc/fstab
/dev/data/partition1 /mnt/p1 ext4 defaults 0 0
/dev/data/partition2 /mnt/p2 ext4 defaults 0 0
/dev/data/partition3 /mnt/p3 ext4 defaults 0 0
```

## 3. Gestion de services

### 1. Interaction avec un service existant
```
[max@node1 ~]$ sudo systemctl status firewalld
● firewalld.service - firewalld - dynamic firewall daemon
     Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor>
     Active: active (running) since Mon 2022-11-14 15:21:04 CET; 
```

### 2. Création de service

#### A. Unité simpliste 

```
[max@node1 system]$ cat web.service
[Unit]
Description=Very simple web service

[Service]
ExecStart=/usr/bin/python3 -m http.server 8888

[Install]
WantedBy=multi-user.target
[max@node1 ~]$ sudo firewall-cmd --add-port=8888/tcp --permanent
success
[max@node1 ~]$ sudo systemctl daemon-reload

[max@node1 ~]$ sudo systemctl start web
[max@node1 ~]$ sudo systemctl enable web
Created symlink /etc/systemd/system/multi-user.target.wants/web.service → /etc/systemd/system/web.service.
[max@node1 ~]$ sudo systemctl status web
● web.service - Very simple web service
     Loaded: loaded (/etc/systemd/system/web.service; enabled; vendor preset: d>
     Active: active (running) since Mon 2022-11-14 18:39:11 CET; 
```

```
[max@node1 ~]$ curl 10.101.1.11:8888
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Directory listing for /</title>
</head>
<body>
<h1>Directory listing for /</h1>
<hr>
<ul>
<li><a href="afs/">afs/</a></li>
<li><a href="bin/">bin@</a></li>
<li><a href="boot/">boot/</a></li>
<li><a href="dev/">dev/</a></li>
<li><a href="etc/">etc/</a></li>
<li><a href="home/">home/</a></li>
<li><a href="lib/">lib@</a></li>
<li><a href="lib64/">lib64@</a></li>
<li><a href="media/">media/</a></li>
<li><a href="mnt/">mnt/</a></li>
<li><a href="opt/">opt/</a></li>
<li><a href="proc/">proc/</a></li>
<li><a href="root/">root/</a></li>
<li><a href="run/">run/</a></li>
<li><a href="sbin/">sbin@</a></li>
<li><a href="srv/">srv/</a></li>
<li><a href="sys/">sys/</a></li>
<li><a href="tmp/">tmp/</a></li>
<li><a href="usr/">usr/</a></li>
<li><a href="var/">var/</a></li>
</ul>
<hr>
</body>
</html>
```

#### B. Modification de l'unité

```
[max@node1 ~]$ sudo useradd web -m -s /bin/sh
[max@node1 ~]$ sudo usermod -aG admins web
[max@node1 ~]$ sudo passwd web
Changing password for user web.
passwd: all authentication tokens updated successfully.
[max@node1 ~]$ su - web
[web@node1 ~]$ cd /var/www/meow/
[web@node1 meow]$ sudo nano waaf
[web@node1 /]$ sudo chown web var/www/meow/waaf
[web@node1 /]$ ls -al /var/www/meow/waaf
-rw-r--r--. 1 web root 5 Nov 14 18:45 /var/www/meow/waaf
[web@node1 ~]$ cat /var/www/meow/waaf
This is a test :) 
```

```
[web@node1 system]$ cat web.service
[Unit]
Description=Very simple web service

[Service]
ExecStart=/usr/bin/python3 -m http.server 8888
User=web
WorkingDirectory=/var/www/meow/

[Install]
WantedBy=multi-user.target
[web@node1 ~]$ sudo systemctl stop web
[web@node1 ~]$ sudo systemctl start web
```

```
[web@node1 ~]$ curl localhost:8888
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Directory listing for /</title>
</head>
<body>
<h1>Directory listing for /</h1>
<hr>
<ul>
<li><a href="waaf">waaf</a></li>
</ul>
<hr>
</body>
</html>
``` 

